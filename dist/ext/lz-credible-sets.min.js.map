{"version":3,"sources":["webpack://[name]/webpack/bootstrap","webpack://[name]/external \"gwasCredibleSets\"","webpack://[name]/./esm/ext/lz-credible-sets.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","gwasCredibleSets","install","LocusZoom","BaseAdapter","Adapters","add","config","super","arguments","this","dependentSource","parseInit","params","fields","log_pvalue","Error","constructor","SOURCE_NAME","assign","threshold","significance_threshold","state","chain","credible_set_threshold","chr","start","end","join","body","length","Promise","resolve","self","nlogpvals","map","item","some","val","credset_data","scores","bayesFactors","posteriorProbabilities","normalizeProbabilities","credibleSet","findCredibleSet","credSetScaled","rescaleCredibleSet","credSetBool","markBoolean","push","posterior_prob","contrib_fraction","is_member","e","console","error","data","outnames","trans","src","dest","keys","forEach","attr","association_credible_set_tooltip","Layouts","unnamespaced","html","namespace","closable","show","or","hide","and","association_credible_set_layer","base","id","fill_opacity","tooltip","match","send","receive","color","unshift","field","scale_function","parameters","field_value","then","annotation_credible_set_layer","type","id_field","x_axis","filters","operator","behaviors","onmouseover","action","status","onmouseout","onclick","exclusive","onshiftclick","tooltip_positioning","annotation_credible_set","title","text","x","style","min_height","height","margin","top","right","bottom","left","inner_border","toolbar","interaction","drag_background_to_pan","scroll_to_zoom","x_linked","data_layers","association_credible_set_panel","widgets","position","button_html","button_title","layer_name","default_config_display_name","options","display_name","display","point_shape","point_size","else","legend","shape","size","label","class","breaks","values","association_credible_set_plot","width","responsive_resize","min_region_scale","max_region_scale","panels","use"],"mappings":"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","file":"ext/lz-credible-sets.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n","module.exports = gwasCredibleSets;","/**\n * Custom code used to power credible sets demonstration example. This is not part of the core LocusZoom library,\n * but can be included as a standalone file.\n *\n * ### Features provided\n * * {@link module:LocusZoom_Adapters~CredibleSetLZ}\n * * {@link module:LocusZoom_Layouts~association_credible_set_tooltip}\n * * {@link module:LocusZoom_Layouts~annotation_credible_set_tooltip}\n * * {@link module:LocusZoom_Layouts~association_credible_set}\n * * {@link module:LocusZoom_Layouts~annotation_credible_set_layer}\n * * {@link module:LocusZoom_Layouts~annotation_credible_set}\n * * {@link module:LocusZoom_Layouts~association_credible_set}\n * * {@link module:LocusZoom_Layouts~association_credible_set_plot}\n *\n * ### Loading and usage\n * The page must incorporate and load all libraries before this file can be used, including:\n *  - LocusZoom\n *  - gwas-credible-sets (available via NPM or a related CDN)\n *\n * To use in an environment without special JS build tooling, simply load the extension file as JS from a CDN (after any dependencies):\n * ```\n * <script src=\"https://cdn.jsdelivr.net/npm/locuszoom@INSERT_VERSION_HERE/dist/ext/lz-credible-sets.min.js\" type=\"application/javascript\"></script>\n * ```\n *\n * To use with ES6 modules, the plugin must be loaded and registered explicitly before use:\n * ```\n * import LocusZoom from 'locuszoom';\n * import credibleSets from 'locuszoom/esm/ext/lz-credible-sets';\n * LocusZoom.use(credibleSets);\n * ```\n @module\n*/\n\nimport {marking, scoring} from 'gwas-credible-sets';\n\nfunction install (LocusZoom) {\n    const BaseAdapter = LocusZoom.Adapters.get('BaseAdapter');\n\n    /**\n     * (**extension**) Custom data adapter that calculates the 95% credible set based on provided association data.\n     * This source must be requested as the second step in a chain, after a previous step that returns fields required\n     *  for the calculation. (usually, it follows a request for GWAS summary statistics)\n     * @alias module:LocusZoom_Adapters~CredibleSetLZ\n     * @see {@link module:ext/lz-credible-sets} for required extension and installation instructions\n     */\n    class CredibleSetLZ extends BaseAdapter {\n        /**\n         * @param {String} config.params.fields.log_pvalue The name of the field containing -log10 pvalue information\n         * @param {Number} [config.params.threshold=0.95] The credible set threshold (eg 95%). Will continue selecting SNPs\n         *  until the posterior probabilities add up to at least this fraction of the total.\n         * @param {Number} [config.params.significance_threshold=7.301] Do not perform a credible set calculation for this\n         *  region unless AT LEAST ONE SNP (as -log10p) exceeds the line of GWAS signficance. Otherwise we are declaring a\n         *  credible set when there is no evidence of anything being significant at all. If one snp is significant, it will\n         *  create a credible set for the entire region; the resulting set may include things below the line of significance.\n         */\n        constructor(config) {\n            super(...arguments);\n            this.dependentSource = true; // Don't do calcs for a region with no assoc data\n        }\n\n        parseInit(config) {\n            super.parseInit(...arguments);\n            if (!(this.params.fields && this.params.fields.log_pvalue)) {\n                throw new Error(`Source config for ${this.constructor.SOURCE_NAME} must specify how to find 'fields.log_pvalue'`);\n            }\n\n            // Set defaults. Default sig threshold is the line of GWAS significance. (as -log10p)\n            this.params = Object.assign(\n                { threshold: 0.95, significance_threshold: 7.301 },\n                this.params\n            );\n        }\n\n        getCacheKey (state, chain, fields) {\n            const threshold = state.credible_set_threshold || this.params.threshold;\n            return [threshold, state.chr, state.start, state.end].join('_');\n        }\n\n        fetchRequest(state, chain) {\n            if (!chain.body.length) {\n                // No credible set can be calculated because there is no association data for this region\n                return Promise.resolve([]);\n            }\n\n            const self = this;\n            // The threshold can be overridden dynamically via `plot.state`, or set when the source is created\n            const threshold = state.credible_set_threshold || this.params.threshold;\n            // Calculate raw bayes factors and posterior probabilities based on information returned from the API\n            if (typeof chain.body[0][self.params.fields.log_pvalue] === 'undefined') {\n                throw new Error('Credible set source could not locate the required fields from a previous request.');\n            }\n            const nlogpvals = chain.body.map((item) => item[self.params.fields.log_pvalue]);\n\n            if (!nlogpvals.some((val) => val >= self.params.significance_threshold)) {\n                // If NO points have evidence of significance, define the credible set to be empty\n                //  (rather than make a credible set that we don't think is meaningful)\n                return Promise.resolve([]);\n            }\n\n            const credset_data = [];\n            try {\n                const scores = scoring.bayesFactors(nlogpvals);\n                const posteriorProbabilities = scoring.normalizeProbabilities(scores);\n\n                // Use scores to mark the credible set in various ways (depending on your visualization preferences,\n                //   some of these may not be needed)\n                const credibleSet = marking.findCredibleSet(posteriorProbabilities, threshold);\n                const credSetScaled = marking.rescaleCredibleSet(credibleSet);\n                const credSetBool = marking.markBoolean(credibleSet);\n\n                // Annotate each response record based on credible set membership\n                for (let i = 0; i < chain.body.length; i++) {\n                    credset_data.push({\n                        posterior_prob: posteriorProbabilities[i],\n                        contrib_fraction: credSetScaled[i],\n                        is_member: credSetBool[i],\n                    });\n                }\n            } catch (e) {\n                // If the calculation cannot be completed, return the data without annotation fields\n                console.error(e);\n            }\n            return Promise.resolve(credset_data);\n        }\n\n        combineChainBody(data, chain, fields, outnames, trans) {\n            // At this point namespacing has been applied; add the calculated fields for this source to the chain\n            if (chain.body.length && data.length) {\n                for (let i = 0; i < data.length; i++) {\n                    const src = data[i];\n                    const dest = chain.body[i];\n                    Object.keys(src).forEach(function (attr) {\n                        dest[attr] = src[attr];\n                    });\n                }\n            }\n            return chain.body;\n        }\n    }\n\n    LocusZoom.Adapters.add('CredibleSetLZ', CredibleSetLZ);\n\n    // Add related layouts to the central global registry\n    /**\n     * (**extension**) Tooltip layout that appends credible set posterior probability to the default association tooltip (for SNPs in the credible set)\n     * @alias module:LocusZoom_Layouts~association_credible_set_tooltip\n     * @type tooltip\n     * @see {@link module:ext/lz-credible-sets} for required extension and installation instructions\n     */\n    const association_credible_set_tooltip = function () {\n        // Extend a known tooltip with an extra row of info showing posterior probabilities\n        const l = LocusZoom.Layouts.get('tooltip', 'standard_association', { unnamespaced: true });\n        l.html += '{{#if {{namespace[credset]}}posterior_prob}}<br>Posterior probability: <strong>{{{{namespace[credset]}}posterior_prob|scinotation|htmlescape}}</strong>{{/if}}';\n        return l;\n    }();\n\n    LocusZoom.Layouts.add('tooltip', 'association_credible_set', association_credible_set_tooltip);\n\n    /**\n     * (**extension**) A tooltip layout for annotation (rug) tracks that provides information about credible set members\n     * @alias module:LocusZoom_Layouts~annotation_credible_set_tooltip\n     * @type tooltip\n     * @see {@link module:ext/lz-credible-sets} for required extension and installation instructions\n     */\n    const annotation_credible_set_tooltip = {\n        namespace: { 'assoc': 'assoc', 'credset': 'credset' },\n        closable: true,\n        show: { or: ['highlighted', 'selected'] },\n        hide: { and: ['unhighlighted', 'unselected'] },\n        html: '<strong>{{{{namespace[assoc]}}variant|htmlescape}}</strong><br>'\n            + 'P Value: <strong>{{{{namespace[assoc]}}log_pvalue|logtoscinotation|htmlescape}}</strong><br>' +\n            '{{#if {{namespace[credset]}}posterior_prob}}<br>Posterior probability: <strong>{{{{namespace[credset]}}posterior_prob|scinotation|htmlescape}}</strong>{{/if}}',\n    };\n    LocusZoom.Layouts.add('tooltip', 'annotation_credible_set', annotation_credible_set_tooltip);\n\n    /**\n     * (**extension**) A data layer layout that shows GWAS summary statistics overlaid with credible set membership information\n     * @alias module:LocusZoom_Layouts~association_credible_set_layer\n     * @type data_layer\n     * @see {@link module:ext/lz-credible-sets} for required extension and installation instructions\n     */\n\n    const association_credible_set_layer = function () {\n        const base = LocusZoom.Layouts.get('data_layer', 'association_pvalues', {\n            unnamespaced: true,\n            id: 'associationcredibleset',\n            namespace: { 'assoc': 'assoc', 'credset': 'credset', 'ld': 'ld' },\n            fill_opacity: 0.7,\n            tooltip: LocusZoom.Layouts.get('tooltip', 'association_credible_set', { unnamespaced: true }),\n            fields: [\n                '{{namespace[assoc]}}variant', '{{namespace[assoc]}}position',\n                '{{namespace[assoc]}}log_pvalue', '{{namespace[assoc]}}log_pvalue|logtoscinotation',\n                '{{namespace[assoc]}}ref_allele',\n                '{{namespace[credset]}}posterior_prob', '{{namespace[credset]}}contrib_fraction',\n                '{{namespace[credset]}}is_member',\n                '{{namespace[ld]}}state', '{{namespace[ld]}}isrefvar',\n            ],\n            match: { send: '{{namespace[assoc]}}variant', receive: '{{namespace[assoc]}}variant' },\n        });\n        base.color.unshift({\n            field: 'lz_is_match',  // Special field name whose presence triggers custom rendering\n            scale_function: 'if',\n            parameters: {\n                field_value: true,\n                then: '#FFf000',\n            },\n        });\n        return base;\n    }();\n    LocusZoom.Layouts.add('data_layer', 'association_credible_set', association_credible_set_layer);\n\n    /**\n     * (**extension**) A data layer layout that shows a vertical mark whenever a SNP is a member of the credible set\n     * @alias module:LocusZoom_Layouts~annotation_credible_set_layer\n     * @type data_layer\n     * @see {@link module:ext/lz-credible-sets} for required extension and installation instructions\n     */\n    const annotation_credible_set_layer = {\n        namespace: { 'assoc': 'assoc', 'credset': 'credset' },\n        id: 'annotationcredibleset',\n        type: 'annotation_track',\n        id_field: '{{namespace[assoc]}}variant',\n        x_axis: {\n            field: '{{namespace[assoc]}}position',\n        },\n        color: [\n            {\n                field: 'lz_is_match',  // Special field name whose presence triggers custom rendering\n                scale_function: 'if',\n                parameters: {\n                    field_value: true,\n                    then: '#001cee',\n                },\n            },\n            '#00CC00',\n        ],\n        fields: ['{{namespace[assoc]}}variant', '{{namespace[assoc]}}position', '{{namespace[assoc]}}log_pvalue', '{{namespace[credset]}}posterior_prob', '{{namespace[credset]}}contrib_fraction', '{{namespace[credset]}}is_member'],\n        match: { send: '{{namespace[assoc]}}variant', receive: '{{namespace[assoc]}}variant' },\n        filters: [\n            // Specify which points to show on the track. Any selection must satisfy ALL filters\n            { field: '{{namespace[credset]}}is_member', operator: '=', value: true },\n        ],\n        behaviors: {\n            onmouseover: [\n                { action: 'set', status: 'highlighted' },\n            ],\n            onmouseout: [\n                { action: 'unset', status: 'highlighted' },\n            ],\n            onclick: [\n                { action: 'toggle', status: 'selected', exclusive: true },\n            ],\n            onshiftclick: [\n                { action: 'toggle', status: 'selected' },\n            ],\n        },\n        tooltip: LocusZoom.Layouts.get('tooltip', 'annotation_credible_set', { unnamespaced: true }),\n        tooltip_positioning: 'top',\n    };\n    LocusZoom.Layouts.add('data_layer', 'annotation_credible_set', annotation_credible_set_layer);\n\n    /**\n     * (**extension**) A panel layout that shows a vertical mark whenever a SNP is a member of the credible set\n     * @alias module:LocusZoom_Layouts~annotation_credible_set\n     * @type panel\n     * @see {@link module:ext/lz-credible-sets} for required extension and installation instructions\n     */\n    const annotation_credible_set = {\n        id: 'annotationcredibleset',\n        title: { text: 'SNPs in 95% credible set', x: 50, style: { 'font-size': '14px' } },\n        min_height: 45,\n        height: 45,\n        margin: { top: 25, right: 50, bottom: 0, left: 50 },\n        inner_border: 'rgb(210, 210, 210)',\n        toolbar: LocusZoom.Layouts.get('toolbar', 'standard_panel', { unnamespaced: true }),\n        interaction: {\n            drag_background_to_pan: true,\n            scroll_to_zoom: true,\n            x_linked: true,\n        },\n        data_layers: [\n            LocusZoom.Layouts.get('data_layer', 'annotation_credible_set', { unnamespaced: true }),\n        ],\n    };\n    LocusZoom.Layouts.add('panel', 'annotation_credible_set', annotation_credible_set);\n\n    /**\n     * (**extension**) A panel layout that shows GWAS summary statistics in a standard LocusZoom view, overlaid with credible set membership information\n     * @alias module:LocusZoom_Layouts~association_credible_set\n     * @type panel\n     * @see {@link module:ext/lz-credible-sets} for required extension and installation instructions\n     */\n    const association_credible_set_panel = function () {\n        const l = LocusZoom.Layouts.get('panel', 'association', {\n            unnamespaced: true,\n            id: 'associationcrediblesets',\n            namespace: { 'assoc': 'assoc', 'credset': 'credset' },\n            data_layers: [\n                LocusZoom.Layouts.get('data_layer', 'significance', { unnamespaced: true }),\n                LocusZoom.Layouts.get('data_layer', 'recomb_rate', { unnamespaced: true }),\n                LocusZoom.Layouts.get('data_layer', 'association_credible_set', { unnamespaced: true }),\n            ],\n        });\n        // Add \"display options\" button to control how credible set coloring is overlaid on the standard association plot\n        l.toolbar.widgets.push(\n            {\n                type: 'display_options',\n                position: 'right',\n                color: 'blue',\n                // Below: special config specific to this widget\n                button_html: 'Display options...',\n                button_title: 'Control how plot items are displayed',\n                layer_name: 'associationcredibleset',\n                default_config_display_name: 'Linkage Disequilibrium (default)', // display name for the default plot color option (allow user to revert to plot defaults)\n\n                options: [\n                    {\n                        // First dropdown menu item\n                        display_name: '95% credible set (boolean)',  // Human readable representation of field name\n                        display: {  // Specify layout directives that control display of the plot for this option\n                            point_shape: 'circle',\n                            point_size: 40,\n                            color: {\n                                field: '{{namespace[credset]}}is_member',\n                                scale_function: 'if',\n                                parameters: {\n                                    field_value: true,\n                                    then: '#00CC00',\n                                    else: '#CCCCCC',\n                                },\n                            },\n                            legend: [ // Tells the legend how to represent this display option\n                                {\n                                    shape: 'circle',\n                                    color: '#00CC00',\n                                    size: 40,\n                                    label: 'In credible set',\n                                    class: 'lz-data_layer-scatter',\n                                },\n                                {\n                                    shape: 'circle',\n                                    color: '#CCCCCC',\n                                    size: 40,\n                                    label: 'Not in credible set',\n                                    class: 'lz-data_layer-scatter',\n                                },\n                            ],\n                        },\n                    },\n                    {\n                        // Second option. The same plot- or even the same field- can be colored in more than one way.\n                        display_name: '95% credible set (gradient by contribution)',\n                        display: {\n                            point_shape: 'circle',\n                            point_size: 40,\n                            color: [\n                                {\n                                    field: '{{namespace[credset]}}contrib_fraction',\n                                    scale_function: 'if',\n                                    parameters: {\n                                        field_value: 0,\n                                        then: '#777777',\n                                    },\n                                },\n                                {\n                                    scale_function: 'interpolate',\n                                    field: '{{namespace[credset]}}contrib_fraction',\n                                    parameters: {\n                                        breaks: [0, 1],\n                                        values: ['#fafe87', '#9c0000'],\n                                    },\n                                },\n                            ],\n                            legend: [\n                                {\n                                    shape: 'circle',\n                                    color: '#777777',\n                                    size: 40,\n                                    label: 'No contribution',\n                                    class: 'lz-data_layer-scatter',\n                                },\n                                {\n                                    shape: 'circle',\n                                    color: '#fafe87',\n                                    size: 40,\n                                    label: 'Some contribution',\n                                    class: 'lz-data_layer-scatter',\n                                },\n                                {\n                                    shape: 'circle',\n                                    color: '#9c0000',\n                                    size: 40,\n                                    label: 'Most contribution',\n                                    class: 'lz-data_layer-scatter',\n                                },\n                            ],\n                        },\n                    },\n                ],\n            }\n        );\n        return l;\n    }();\n    LocusZoom.Layouts.add('panel', 'association_credible_set', association_credible_set_panel);\n\n    /**\n     * (**extension**) A standard LocusZoom plot layout, with additional credible set information.\n     * @alias module:LocusZoom_Layouts~association_credible_set_plot\n     * @type plot\n     * @see {@link module:ext/lz-credible-sets} for required extension and installation instructions\n     */\n    const association_credible_set_plot = {\n        state: {},\n        width: 800,\n        height: 450,\n        responsive_resize: true,\n        min_region_scale: 20000,\n        max_region_scale: 1000000,\n        toolbar: LocusZoom.Layouts.get('toolbar', 'standard_association', { unnamespaced: true }),\n        panels: [\n            LocusZoom.Layouts.get('panel', 'association_credible_set', { unnamespaced: true }),\n            LocusZoom.Layouts.get('panel', 'annotation_credible_set', { unnamespaced: true }),\n            LocusZoom.Layouts.get('panel', 'genes', { unnamespaced: true }),\n        ],\n    };\n    LocusZoom.Layouts.add('plot', 'association_credible_set', association_credible_set_plot);\n}\n\n\nif (typeof LocusZoom !== 'undefined') {\n    // Auto-register the plugin when included as a script tag. ES6 module users must register via LocusZoom.use()\n    // eslint-disable-next-line no-undef\n    LocusZoom.use(install);\n}\n\n\nexport default install;\n"],"sourceRoot":""}